<%- include ('../partials/header.ejs') %>

<div class="row">
    <div class="col-md-8">
        <div class="pt-4 pb-3">
            <div class="">
                <div class="fs-x-small">
                    <span class="pointer fw-x-normal" onclick="location .href='/author/<%= post.authorId %>'">
                        <%= post.authorNickname %>
                    </span>
                    <small class="px-1">&#xb7;</small>
                    <span class="text-muted">
                        <%= formatDistanceToNow(post.createdAt, { addSuffix: true }) %>
                    </span>
                    <small class="px-1">&#xb7;</small>
                    <span>
                        <%= post.readingTime %> min read
                    </span>
                </div>   
            </div>

            <h1 class="fw-bold py-3"><%= post.title %></h1>

            <div class="d-flex justify-content-between border-top border-bottom mt-3 py-2">
                <%- include('../partials/fragments/reactions.ejs')  %>
                <div>
                    <div class="dropdown">
                        <button class="btn" type="button" data-bs-toggle="dropdown" data-bs-auto-close="outside" aria-expanded="false">
                            <i class="fa-solid fa-ellipsis"></i>
                        </button>
                        <ul class="dropdown-menu">
                            <% if(locals.user && locals.user.id === post.authorId) { %> 
                                <li><a class="dropdown-item" href="/edit/<%= post.slug %>">Edit</a></li>
                                <li><a class="dropdown-item text-danger" href="/delete/<%= post.id %>">Delete</a></li>
                                <% if (!post.published) { %>
                                    <li><button class="dropdown-item" onclick="publish(this, '<%= post.id %>')">Publish</button></li>
                                <% } %>
                            <% } %>
                            <li><a class="dropdown-item pointer" onclick="copyLinkToClipBoard('/read/<%= post.slug %>')">Copy Link</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    
        <div class="post-content my-4"><%- post.content %></div>

        <div class="my-3">
            <a href="/thoughts?search=<%= post.categoryName %>" class="px-3 fs-small badge py-2 me-1 mb-1 fw-x-normal rounded-pill bg-light-2">
                <%= post.categoryName %>
            </a>
            <% post.hashtags.forEach(tag => { %>
                <a href="/thoughts?search=<%= tag %>" class="px-3 fs-small badge py-2 me-1 mb-1 fw-x-normal rounded-pill bg-light-2">
                    <%= tag %>
                </a>
            <% }) %>
        </div>

        <div class="py-5">
            <h3 class="text-center">
                <span class="px-2">&#xb7;</span>
                <span class="px-2">&#xb7;</span>
                <span class="px-2">&#xb7;</span>
            </h3>
            <% if (data.posts || data.posts.length > 0) { %>
                <h6 class="text-center fw-light text-uppercase my-4 text-muted">
                    Check Out Other Thoughts
                </h6>
            <% } %>
            
            <%- include ('../partials/posts.ejs') %> 
        </div>
    </div>
    <div class="col-md-4">
        <div class="fixed-column bg-white p-4">
            <h3>Comments</h3>
            <% post.comments.forEach(comment => { %>
                <div class="border-bottom py-3">
                    <div class="d-flex justify-content-between">
                        <div>
                            <span class="fw-bold"><%= comment.authorNickname %></span>
                            <small class="px-1">&#xb7;</small>
                            <span class="text-muted"><%= formatDistanceToNow(comment.createdAt, { addSuffix: true }) %></span>
                        </div>
                        <div>
                            <% if(locals.user && locals.user.id === comment.authorId) { %>
                                <button class="btn" onclick="deleteComment(this, '<%= comment.id %>')">
                                    <i class="fa-solid fa-trash"></i>
                                </button>
                            <% } %>
                        </div>
                    </div>
                    <div class="mt-2">
                        <p><%= comment.content %></p>
                    </div>
                </div>
            <% }) %>
        </div>
    </div>
</div>

<%- include ('../partials/footer.ejs') %>